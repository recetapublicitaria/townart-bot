const OpenAI = require("openai");

// Cliente OpenAI
const client = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

// FunciÃ³n robusta para preguntar a OpenAI
async function ask(prompt) {
  try {
    const completion = await client.chat.completions.create({
      model: "gpt-4.1-mini", // Se puede cambiar cuando quieras
      messages: [{ role: "user", content: prompt }],
      temperature: 0.8,
      max_tokens: 450,
    });

    return completion.choices[0].message.content.trim();
  } catch (err) {
    console.error("âŒ Error llamando OpenAI:", err);

    // Errores de lÃ­mite
    if (err.code === "rate_limit_exceeded") {
      return (
        "Ay, dame un segundito ğŸ’œâ€¦ estoy procesando mucha informaciÃ³n ahora.\n" +
        "Â¿Me repites tu mensaje en un momentito?"
      );
    }

    return (
      "Upsâ€¦ tuve un problema para responderte ğŸ’œ\n" +
      "Â¿Puedes escribirlo de nuevo?"
    );
  }
}

module.exports = { ask };
